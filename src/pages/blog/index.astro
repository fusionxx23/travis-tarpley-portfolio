---
import RootLayout from "../../layouts/RootLayout.astro";
// import BaseHead from "../../components/BaseHead.astro";
import Header from "../../components/Header.astro";
import { getCollection } from "astro:content";
import FormattedDate from "../../components/FormattedDate.astro";
import { Image } from "astro:assets";
import { DB_API_URL } from "../../data/constants";
import { z } from "zod";
export const BlogSchema = z.object({
  id: z.number(),
  title: z.string(),
  description: z.string(),
  blogcontent: z.string(),
  imagekey: z.string(),
  created_at: z.string().datetime(),
  updated_at: z.string().datetime(),
  slug: z.string(),
});

// id: 1,
// title: 'test',
// description: 'test',
// blogcontent: 'test blog',
// slug: 'test',
// imagekey: '28db447d-f444-4320-a500-4c0040a0356d.png',
// created_at: '2024-11-14T03:44:48.786Z',
// updated_at: '2024-11-14T03:44:48.786Z'
export type TBlog = z.infer<typeof BlogSchema>;
export const BlogsSchema = z.array(BlogSchema);
const posts = (await getCollection("blog")).sort(
  (a, b) =>
    b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
const resp = await fetch(DB_API_URL + "/blog", {
  headers: {
    Authorization: `Bearer ${process.env.BEARER}`,
  },
})
  .then((r) => r.json())
  .catch((e) => console.log("Error"));
console.log(resp, "RESPONSE");
const safeBlogs = BlogsSchema.safeParse(resp);
console.log(safeBlogs.error, "safe blogs");
---

<RootLayout>
  <!-- <BaseHead -->
  <!--   title={SITE_TITLE} -->
  <!--   description={SITE_DESCRIPTION} -->
  <!-- /> -->

  <div class="pt-[60px]"></div>
  <main class="flex justify-center">
    <section class="">
      <h1 class="text-3xl py-4 text-gray-100 font-semibold">
        My Latest Posts
      </h1>
      <ul class="space-y-8">
        {
          safeBlogs?.data?.map((post) => (
            <li
              class="bg-black/50 w-[600px] border border-purple-300/50 rounded-lg
                p-4"
            >
              <a class="" href={`/blog/${post.slug}/`}>
                <div class="flex gap-x-4">
                  <div class="w-[150px]">
                    <Image
                      width={150}
                      height={100}
                      class="object-cover w-[150px] h-[100px]"
                      src={
                        "https://d21g8sblvruk6e.cloudfront.net/" +
                        post.imagekey
                      }
                      alt=""
                    />
                  </div>
                  <div class="flex flex-col justify-between gap-y-4">
                    <div>
                      <h4 class="text-3xl">{post.title}</h4>
                      <p class="text-gray-400 text-[14px]">
                        {post.description}
                        Lorem ipsum dolor sit, amet
                        consectetur adipisicing elit. Facere
                      </p>
                    </div>
                    <p class="text-gray-200 text-sm">
                      <FormattedDate
                        date={new Date(post.created_at)}
                      />
                    </p>
                  </div>
                </div>
              </a>
            </li>
          ))
        }
      </ul>
    </section>
  </main>
</RootLayout>

<Header />
